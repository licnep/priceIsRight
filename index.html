<head>
  <script src="https://unpkg.com/peerjs@1.3.2/dist/peerjs.min.js"></script>
</head>

<script>
var peer = new Peer();
  
peer.on('open', function (id) {
    // Workaround for peer.reconnect deleting previous id
    if (peer.id === null) {
        console.log('Received null id from peer open');
        peer.id = lastPeerId;
    } else {
        lastPeerId = peer.id;
    }

    console.log('ID: ' + peer.id);
    var a = document.createElement('a');
    a.innerHTML = "https://licnep.github.io/priceIsRight/?g="+peer.id;
    a.href = "https://licnep.github.io/priceIsRight/?g="+peer.id;
    document.body.appendChild(a);
  
    var server = new URLSearchParams(window.location.search).get('g');
    if (server) {
      var conn = peer.connect(server);
          conn.on('open', function(){
            // here you have conn.id
            conn.send('hi! '+peer.id);
            
            conn.on('data', function(data){
              document.body.innerHTML += "<br/>"+data;
              console.log(data);
            });
          });
    }
});
  
peer.on('connection', function(conn) {
  conn.on('data', function(data){
    document.body.innerHTML += "<br/>"+data;
    console.log(data);
  });
});
  
function send(m) {
   for (conn in peer.connections) {c = peer.connections[conn][0]; if (c) c.send(m);} 
}

</script>
